(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();class h{constructor(){this.isDragging=!1,this.xOffset=0,this.yOffset=0,this.currentX=void 0,this.currentY=void 0,this.initialX=void 0,this.initialY=void 0,this.appName="",this.startTime=void 0,this.domElement=void 0,this.minimized=!1,this.body=document.createElement("div"),this.body.className="app",this.body.tabIndex=0,this.header=document.createElement("div"),this.header.className="appHeader",this.main=document.createElement("div"),this.main.className="appMain",this.closeContainer=document.createElement("div"),this.closeContainer.className="appCloseButton",this.closeButton=document.createElement("button"),this.closeButton.className="appCloseButton",this.closeContainer.append(document.createTextNode("X")),this.closeContainer.append(this.closeButton),this.minimizeContainer=document.createElement("div"),this.minimizeContainer.className="appMinimizeButton",this.minimizeContainer.append(document.createTextNode("_")),this.header.append(this.minimizeContainer),this.header.append(this.closeContainer),this.body.appendChild(this.header),this.body.appendChild(this.main),this.header.addEventListener("click",e=>{e.target.className==="appCloseButton"?(e.target.parentNode.parentNode.remove(),this.closeApp()):e.target.className==="appMinimizeButton"&&this.minimizeApp(e)}),this.header.addEventListener("mousedown",e=>{e.target.focus(),this.initialX=e.clientX-this.xOffset,this.initialY=e.clientY-this.yOffset,this.header.contains(e.target)&&e.target.className!=="appCloseButton"&&(this.isDragging=!0)}),this.header.addEventListener("mouseup",()=>{this.initialX=this.currentX,this.initialY=this.currentY,this.isDragging=!1}),document.querySelector("body").parentElement.addEventListener("mousemove",e=>{this.isDragging&&(e.preventDefault(),this.currentX=e.clientX-this.initialX,this.currentY=e.clientY-this.initialY,this.xOffset=this.currentX,this.yOffset=this.currentY,this.body.style.transform=`translate3d(${this.currentX}px, ${this.currentY}px, 0)`)})}setDomElement(e){this.domElement=e}getDomElement(){return this.domElement}closeApp(){this.domElement.remove()}minimizeApp(){this.minimized=!this.minimized,this.header.parentNode.parentNode.className=this.minimized?"appMinimized":"app"}}class p{constructor(e,t){this.x=e,this.y=t,this.isHit=!1,this.isShip=!1,this.ship=void 0,this.shipPart=void 0,this.rotation=void 0}}class y extends h{constructor(){super(),this.appName="Battleship",this.header.innerHTML+=`<h1>${this.appName}</h1>`,this.windowBody=void 0,this.userName=void 0,this.myTurn=!1,this.gameStarted=!1,sessionStorage.getItem("username")!==null&&(this.userName=sessionStorage.getItem("username")),this.ws=new WebSocket("wss://courselab.lnu.se/message-app/socket"),this.ws.onmessage=e=>{const t=JSON.parse(e.data);t.username!=="The Server"&&t.channel==="Battleship"&&this.wsRecieve(t)},this.game=document.createElement("div"),this.gameBody=document.createElement("div"),this.gameBody.className="battleshipGameBody",this.boardContainer=document.createElement("div"),this.opponentBoardContainer=document.createElement("div"),this.gameBody.append(this.boardContainer),this.gameBody.append(this.opponentBoardContainer),this.turnText=document.createElement("p"),this.board=[],this.opponentBoard=[],this.boardSize=6,this.ships=["carrier","battleship","cargo"],this.initBoards(),this.opponentBoardContainer.addEventListener("click",e=>this.gameLoopSend(e))}renderWindow(e){this.windowBody=e,this.body.className="app",this.body.style.left=`${this.windowBody.clientWidth/2}px`,this.body.style.top=`${(this.windowBody.clientHeight-80)/2}px`,this.body.style.paddingBottom="10px",this.windowBody.appendChild(this.body),this.game.className="battleshipGame",this.main.append(this.game),this.boardContainer.className="battleshipButtonContainer",this.opponentBoardContainer.className="battleshipButtonContainer",this.game.append(this.gameBody),this.game.append(this.turnText);for(let t=0;t<this.boardSize;t++){const s=document.createElement("div");s.className="boardRow",this.boardContainer.append(s);for(let n=0;n<this.boardSize;n++){const i=document.createElement("div");i.className="battleshipBoardCell",i.id=`p${t}${n}`,this.board[t][n].isShip&&(i.style.backgroundImage=`url(./img/battleship/${this.board[t][n].ship}${this.board[t][n].shipPart}.png)`,i.style.rotate=`${(this.board[t][n].rotation-1)*90}deg`),s.append(i)}}for(let t=0;t<this.boardSize;t++){const s=document.createElement("div");s.className="boardRow",this.opponentBoardContainer.append(s);for(let n=0;n<this.boardSize;n++){const i=document.createElement("div");i.className="battleshipBoardCell",i.id=`o${t}${n}`,s.append(i)}}}gameLoopSend(e){if(this.myTurn){const t=parseInt(e.target.id[1]),s=parseInt(e.target.id[2]);this.wsSend(`${t}${s}`),this.myTurn=!1,this.turnText.innerHTML="Waiting for opponent..."}else this.gameStarted===!1&&this.wsSend({question:"myturn?",answer:null})}gameLoopRecieve(e){const t=parseInt(e.x),s=parseInt(e.y);if(this.board[t][s].isShip){this.board[t][s].isHit=!0;const n=document.createElement("div");n.style.backgroundImage="url(./img/battleship/checked.png)",n.style.width="26px",n.style.height="26px",n.style.opacity="0.5",document.getElementById(`p${t}${s}`).append(n),this.wsSend({x:t,y:s,hit:!0})}else this.board[t][s].isHit=!0,document.getElementById(`p${t}${s}`).style.backgroundImage="url(./img/battleship/checked.png)",this.wsSend({x:t,y:s,hit:!1})}initBoards(){for(let e=0;e<this.boardSize;e++){this.board[e]=[];for(let t=0;t<this.boardSize;t++)this.board[e][t]=new p(e,t)}for(let e=0;e<this.boardSize;e++){this.opponentBoard[e]=[];for(let t=0;t<this.boardSize;t++)this.opponentBoard[e][t]=new p(e,t)}for(let e=0;e<this.ships.length;e++){const t=Math.floor(Math.random()*6),s=Math.floor(Math.random()*6);let n=Math.floor(Math.random()*4)+1;t>3&&n===2?n=4:s>3&&n===1?n=3:t<2&&n===4?n=2:s<2&&n===3&&(n=1),this.assignShips(e,t,s,n)}}assignShips(e,t,s,n){switch(this.board[t][s].isShip=!0,this.board[t][s].ship=this.ships[e],this.board[t][s].shipPart="back",this.board[t][s].rotation=n,n){case 1:this.board[t][s+1].isShip=!0,this.board[t][s+1].shipPart="middle",this.board[t][s+1].ship=this.ships[e],this.board[t][s+1].rotation=n,this.board[t][s+2].isShip=!0,this.board[t][s+2].ship=this.ships[e],this.board[t][s+2].shipPart="front",this.board[t][s+2].rotation=n;break;case 2:this.board[t+1][s].isShip=!0,this.board[t+1][s].ship=this.ships[e],this.board[t+1][s].shipPart="middle",this.board[t+1][s].rotation=n,this.board[t+2][s].isShip=!0,this.board[t+2][s].ship=this.ships[e],this.board[t+2][s].shipPart="front",this.board[t+2][s].rotation=n;break;case 3:this.board[t][s-1].isShip=!0,this.board[t][s-1].ship=this.ships[e],this.board[t][s-1].shipPart="middle",this.board[t][s-1].rotation=n,this.board[t][s-2].isShip=!0,this.board[t][s-2].ship=this.ships[e],this.board[t][s-2].shipPart="front",this.board[t][s-2].rotation=n;break;case 4:this.board[t-1][s].isShip=!0,this.board[t-1][s].ship=this.ships[e],this.board[t-1][s].shipPart="middle",this.board[t-1][s].rotation=n,this.board[t-2][s].isShip=!0,this.board[t-2][s].ship=this.ships[e],this.board[t-2][s].shipPart="front",this.board[t-2][s].rotation=n;break}}wsRecieve(e){if(e.username!==this.userName)if(e.data.question==="myturn?"&&this.gameStarted===!1)this.wsStartLogic(e);else if(e.data.hit!==void 0)this.wsHitLogic(e);else{const t=parseInt(e.data[0]),s=parseInt(e.data[1]);this.myTurn=!0,this.turnText.innerHTML="Your turn",this.gameLoopRecieve({x:t,y:s})}}wsStartLogic(e){console.log("wsTurn recieved:",e),e.data.answer===null?this.myTurn===!1&&(this.wsSend({question:"myturn?",answer:!0}),this.turnText.innerHTML="Waiting for opponent...",this.gameStarted=!0):e.data.answer&&(this.myTurn=!0,this.turnText.innerHTML="Your turn",this.gameStarted=!0)}wsHitLogic(e){console.log("wsHit recieved:",e);const t=parseInt(e.data.x),s=parseInt(e.data.y);e.data.hit?(this.opponentBoard[t][s].isHit=!0,document.getElementById(`o${t}${s}`).style.backgroundImage="url(./img/battleship/checked.png)",document.getElementById(`o${t}${s}`).style.opacity="0.5"):(this.opponentBoard[t][s].isHit=!0,document.getElementById(`o${t}${s}`).style.backgroundImage="url(./img/battleship/checked.png)")}wsSend(e){this.ws.send(JSON.stringify({type:"message",data:e,username:this.userName,channel:"Battleship",key:"eDBE76deU7L0H9mEBgxUKVR0VCnq0XBd"}))}}class b extends h{constructor(){super(),this.appName="Chat",this.maxMessageLength=24,this.listeningChannel="Robin",this.userName=sessionStorage.getItem("username"),this.windowCreated=!1,this.messages=document.createElement("div"),this.getUsername=document.createElement("div"),this.currentChannel=document.createElement("label"),this.ws=new WebSocket("wss://courselab.lnu.se/message-app/socket"),this.ws.onmessage=e=>{const t=JSON.parse(e.data);t.username!=="The Server"&&t.channel===this.listeningChannel&&this.renderMessage(t)}}renderWindow(e){for(;this.main.firstChild;)this.main.removeChild(this.main.lastChild);if(!this.windowCreated&&(this.windowCreated=!0,this.body.className="app",this.body.id="chat",this.body.style.left=`${e.clientWidth/2}px`,this.body.style.top=`${(e.clientHeight-80)/2}px`,this.body.style.paddingBottom="10px",e.appendChild(this.body),this.header.lastChild.textContent!=="Chat App")){const r=document.createElement("h1");r.innerText="Chat App",this.header.appendChild(r)}if(this.userName===null){this.renderGetUsername(e);return}this.messages.className="messagesDiv";const t=document.createElement("div"),s=document.createElement("p");s.id="usernameChat",s.innerText="Username: "+this.userName,t.appendChild(s),this.main.appendChild(t),t.addEventListener("click",()=>this.changeUsername()),this.currentChannel.innerText="Channel: "+this.listeningChannel,this.main.appendChild(this.currentChannel),this.main.appendChild(this.messages);const n=document.createElement("div");n.className="inputDiv",this.main.appendChild(n);const i=document.createElement("input");i.type="text",i.id="message-input",i.placeholder="Enter your message",n.appendChild(i);const o=document.createElement("button");o.id="send-button",o.innerText="Send",n.appendChild(o),o.addEventListener("click",()=>{i.value.includes("/join")?(this.listeningChannel=i.value.split(" ")[1],this.currentChannel.innerText="Channel: "+this.listeningChannel):this.sendMessage(i.value),i.value=""}),i.addEventListener("keydown",r=>{r.key==="Enter"&&o.click()})}sendMessage(e){e.length>this.maxMessageLength||(this.listeningChannel==="Robin"&&(e=this.cypher(e,"cypher")),this.ws.send(JSON.stringify({type:"message",data:e,username:this.userName,channel:this.listeningChannel,key:"eDBE76deU7L0H9mEBgxUKVR0VCnq0XBd"})))}renderMessage(e){if(e.data==="")return;const t=document.createElement("p");e.channel==="Robin"?t.innerHTML=e.username+": "+this.cypher(e.data,"decypher"):t.innerHTML=e.username+": "+e.data,this.messages.children.length>20&&this.messages.removeChild(this.messages.firstChild),this.messages.append(t),this.messages.scrollTop=this.messages.scrollHeight}cypher(e,t){const s="abcdefghijklmnopqrstuvwxyz\xE5\xE4\xF6ABCDEFGHIJKLMNOPQRSTUVWXYZ\xC5\xC4\xD6",n=[];if(t==="cypher")for(const i of e)n.push(s[(s.indexOf(i)+3)%s.length]);else for(const i of e)n.push(s[(s.indexOf(i)+s.length-3)%s.length]);return n.join("")}changeUsername(){this.userName=null,this.renderGetUsername(this.body)}}class c{#e;constructor(e){this.tiles=["game_1","game_2","game_3","game_4","game_5","game_6","game_7","game_8"],this.empty="none",this.#e=e,this.complete=!1}getEmpty(){return this.empty}getValue(){return this.tiles[this.#e]}setComplete(){this.complete=!0}}class v extends h{constructor(){super(),this.appName="Memory",this.windowBody=void 0,this.currentObjectUp=void 0,this.lastObjectUp=void 0,this.lastEventTarget=void 0,this.won=!1,this.moves=0,this.winAmount=16,this.completed=0,this.gameStyle="v",this.board=[[void 0,void 0,void 0,void 0],[void 0,void 0,void 0,void 0],[void 0,void 0,void 0,void 0],[void 0,void 0,void 0,void 0]],this.main.addEventListener("click",e=>this.turnCard(e.target)),this.main.addEventListener("keypress",e=>this.turnCard(e.target)),this.header.innerHTML+=`<h1>${this.appName}</h1>`,this.values=[1,1,2,2,3,3,4,4,5,5,6,6,7,7,0,0].sort(()=>.5-Math.random());for(let e=0;e<this.board.length;e++)for(let t=0;t<this.board[e].length;t++)this.board[e][t]=new c(this.values.splice(0,1))}renderWindow(e){this.windowBody===void 0&&(this.windowBody=e),this.body.className="app",this.body.style.left=`${this.windowBody.clientWidth/2}px`,this.body.style.top=`${(this.windowBody.clientHeight-80)/2}px`,this.body.style.paddingBottom="10px",this.windowBody.appendChild(this.body);for(let s=0;s<this.board.length;s++){const n=document.createElement("div");n.className="memoryButtonContainer",this.main.append(n);for(let i=0;i<this.board[s].length;i++){const o=document.createElement("div");o.className="memoryButtons",o.tabIndex=0,n.append(o);const r=document.createElement("button");r.id=`${s}${i}`,o.append(r)}}const t=document.createElement("div");t.className="dropDownDiv",this.main.append(t),t.innerHTML+=`
    <select id = "myList">  
    <option> ---Size--- </option>  
    <option> 4x4 </option>
    <option> 2x4 </option>
    <option> 2x2 </option>
    </select>
    `,t.innerHTML+=`
    <select id = "gameStyle">  
    <option> ---Style--- </option>  
    <option> Robin </option>  
    <option> Characters </option>  
    </select>
    `,document.getElementById("myList").addEventListener("change",s=>this.changeBoardSize(s)),document.getElementById("gameStyle").addEventListener("change",s=>this.changeBoardStyle(s))}async turnCard(e){if(e.className!=="memoryButtons"||e===this.lastEventTarget||this.won)return;const t=parseInt(e.children[0].id[0]),s=parseInt(e.children[0].id[1]);if(this.currentObjectUp=this.board[t][s],this.currentObjectUp.complete){this.currentObjectUp=void 0;return}const n=this.currentObjectUp.getValue();if(e.style.backgroundImage=`url(../img/memory/${this.gameStyle+n}.png)`,this.lastObjectUp===void 0){this.lastObjectUp=this.currentObjectUp,this.lastEventTarget=e,this.currentObjectUp=void 0;return}if(n===this.lastObjectUp.getValue()?(this.lastObjectUp.setComplete(),this.currentObjectUp.setComplete(),this.completed+=2):await new Promise(i=>setTimeout(i,500)).then(()=>{this.lastEventTarget.style.backgroundImage="url(../img/memory/rnone.png)",e.style.backgroundImage="url(../img/memory/rnone.png)"}),this.lastObjectUp=void 0,this.currentObjectUp=void 0,this.lastEventTarget=void 0,this.moves++,this.completed===this.winAmount){this.won=!0;const i=document.createElement("h1");i.innerHTML=`You won in ${this.moves} moves!`,this.main.append(i)}}changeBoardSize(e){const t=e.target.options[e.target.selectedIndex].text;for(;this.main.firstChild;)this.main.removeChild(this.main.lastChild);this.currentObjectUp=void 0,this.lastObjectUp=void 0,this.lastEventTarget=void 0,this.won=!1,this.moves=0,this.completed=0;const s=parseInt(t[0]),n=parseInt(t[2]);this.winAmount=s*n,this.values=[];for(let i=0;i<s*n;i++)this.values.push(Math.floor(i/2));this.values.sort(()=>.5-Math.random()),this.board=[];for(let i=0;i<s;i++){this.board.push([]);for(let o=0;o<n;o++)this.board[i][o]=new c(this.values.splice(0,1))}this.renderWindow(this.body)}changeBoardStyle(e){e.target.options[e.target.selectedIndex].text==="Robin"?this.gameStyle="r":e.target.options[e.target.selectedIndex].text==="Characters"&&(this.gameStyle="v");for(let t=0;t<this.board.length;t++)for(let s=0;s<this.board[t].length;s++){const n=this.board[t][s].getValue();this.board[t][s].complete&&(document.getElementById(`${t}${s}`).parentElement.style.backgroundImage=`url(../img/memory/${this.gameStyle+n}.png)`)}}}const l=document.querySelector(".header");l.style.zIndex="1000";const u=document.querySelector(".body"),d=document.querySelector(".footer");d.style.zIndex="1000";const g=[];w();function w(){E(),f(),C(),x()}function f(){const a=document.createElement("div");a.className="login";const e=document.createElement("p");e.innerHTML="Username:";const t=document.createElement("input");t.type="text",t.addEventListener("keyup",n=>{n.key==="Enter"&&s.click()});const s=document.createElement("button");s.innerHTML="Login",s.addEventListener("click",()=>{t.value!==""&&(sessionStorage.setItem("username",t.value),a.remove(),document.getElementById("username").innerHTML=`Logged in as ${t.value}`)}),a.appendChild(e),a.appendChild(t),a.appendChild(s),u.appendChild(a)}function E(){const a=document.createElement("div"),e=document.createElement("p");e.id="username",e.innerHTML="Not currently logged in.",e.style.color="white",a.append(e);const t=document.createElement("p");t.id="usernameTooltip",t.innerHTML="Click to change username",t.style.display="none",a.append(t),l.append(a),a.addEventListener("mouseover",()=>{t.style.display="block",t.style.backgroundColor="black",t.style.width="fit-content",t.style.paddingLeft="5px",t.style.paddingRight="5px"}),a.addEventListener("mouseleave",()=>{t.style.display="none"}),a.addEventListener("click",()=>{f()})}function C(){const a=["memoryapp","chatapp","battleshipapp"];for(const t of a){const s=document.createElement("div"),n=document.createElement("button");n.style.display="none",s.append(n);const i=document.createElement("p");i.id="appTooltip",i.innerHTML="Start "+t,i.style.display="none",s.append(i),s.name=t,s.style.width="50px",s.style.height="50px",s.style.backgroundImage=`url(../img/apps/${t}.png)`,d.append(s),s.addEventListener("mouseover",()=>{i.style.display="block",i.style.top="-40px",i.style.position="relative",i.style.textAlign="center",i.style.backgroundColor="black",i.style.color="white",i.style.width="fit-content",i.style.paddingLeft="5px",i.style.paddingRight="5px"}),s.addEventListener("mouseleave",()=>{i.style.display="none"})}const e=document.createElement("div");e.className="footerLine",d.append(e)}function x(){const a=document.createElement("label");a.id="clock",a.style.position="absolute",a.style.zIndex="100",a.style.color="white",a.style.right="10px",a.style.top="5px",l.appendChild(a),m(),setInterval(m,1e4)}function m(){const a=new Date;let e=a.getHours(),t=a.getMinutes();e<10&&(e="0"+e),t<10&&(t="0"+t);const s=e+":"+t;document.getElementById("clock").innerHTML=s}function B(a,e){const t=document.createElement("div");t.className="applicationIcon",t.style.backgroundImage=`url(../img/apps/${e}.png)`,t.style.width="50px",t.style.height="50px",a.setDomElement(t),d.append(t),g.push(a),a.renderWindow(u)}d.addEventListener("pointerdown",function(a){if(console.log(a.target.name),a.target.name!==void 0){let e;switch(a.target.name){case"memoryapp":e=new v;break;case"chatapp":e=new b;break;case"battleshipapp":e=new y;break}B(e,a.target.name)}else if(a.target.className==="applicationIcon")for(const e of g)e.getDomElement()===a.target&&(e.header.focus(),e.minimizeApp())});
